"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[9372],{7155:(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var s=a(641);const o={class:"card"},i={class:"card-body"},r={class:"row"},l={class:"col-md-8"},n={class:"form-group col-sm-8"},u={class:"row submit-row"},m={class:"col-md-12"},d=["disabled"];var c=a(9639),h=a(3855),g=a(3795),p=a(1080),v=a(9581);const L={name:"NewCustomer",setup:()=>({v$:(0,c.Ay)()}),components:{NewCustomerForm:g.A,NSelect:p.A},props:{organisationName:{type:String,default:""},rootUrl:{type:String,default:"/"},theme:{type:String,default:""},titleList:{type:Array,default:()=>[]}},data:()=>({customerEmailModel:"",customerFirstNameModel:"",customerLastNameModel:"",disableSubmitButton:!1,flagValidationCheck:!1,organisationFixList:[],organisationModel:"",searchTimeout:"",titleModel:[]}),validations:()=>({customerEmailModel:{required:h.mw,email:h.Rp},customerFirstNameModel:{required:h.mw},customerLastNameModel:{required:h.mw},titleModel:{required:h.mw}}),methods:{useNBTheme:v.p,fetchOptions(e,t){""!==this.searchTimeout&&clearTimeout(this.searchTimeout),e.length>=3&&(this.searchTimeout=setTimeout((()=>{this.getOrganisationData(e,t)}),500))},getOrganisationData(e){const t=new FormData;t.set("search",e),this.axios.post(`${this.rootUrl}search/organisation/data/`,t).then((e=>{const t=e.data;this.organisationFixList=t.map((e=>({value:e.pk,label:e.fields.organisation_name})))})).catch((e=>{this.$store.dispatch("newToast",{header:"Error Getting Organisation Data",message:`Error getting organisation data. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))},async submitNewCustomer(){if(this.flagValidationCheck=!0,setTimeout((()=>{this.flagValidationCheck=!1}),100),this.v$.$touch(),!await this.v$.$validate())return void this.$store.dispatch("newToast",{header:"Error submitting new customer",message:`Sorry, we had an submitting new customer. Error -> ${error}`,extra_classes:"bg-danger",delay:0});this.disableSubmitButton=!0;const e=new FormData;e.set("customer_title",this.titleModel),e.set("customer_first_name",this.customerFirstNameModel),e.set("customer_last_name",this.customerLastNameModel),e.set("customer_email",this.customerEmailModel),""!==this.organisationModel&&null!==this.organisationModel&&e.set("organisation",this.organisationModel),this.axios.post(`${this.rootUrl}new_customer/save/`,e).then((e=>{window.location.href=e.data})).catch((e=>{this.$store.dispatch("newToast",{header:"Error submitting new customer",message:`Sorry, we had an submitting new customer. Error -> ${e}`,extra_classes:"bg-danger",delay:0}),this.disableSubmitButton=!1}))},updateCustomerData(e){this[e.field]=e.value}},mounted(){this.$nextTick((()=>{this.getOrganisationData("","")}))}},M=(0,a(6262).A)(L,[["render",function(e,t,a,c,h,g){const p=(0,s.g2)("new-customer-form"),v=(0,s.g2)("n-select"),L=(0,s.g2)("n-config-provider");return(0,s.uX)(),(0,s.Wv)(L,{theme:g.useNBTheme(a.theme)},{default:(0,s.k6)((()=>[(0,s.Lk)("div",o,[(0,s.Lk)("div",i,[(0,s.Q3)(" HEADER "),t[5]||(t[5]=(0,s.Lk)("h1",null,"New Customer",-1)),t[6]||(t[6]=(0,s.Lk)("hr",null,null,-1)),t[7]||(t[7]=(0,s.eW)(" New Customer Form ")),(0,s.bF)(p,{"organisation-name":a.organisationName,"title-list":a.titleList,"flag-validation-check":h.flagValidationCheck,onUpdate_customer_data:t[0]||(t[0]=e=>g.updateCustomerData(e))},null,8,["organisation-name","title-list","flag-validation-check"]),(0,s.Q3)(" CUSTOMER ORGANISATION "),t[8]||(t[8]=(0,s.Lk)("hr",null,null,-1)),(0,s.Lk)("div",r,[t[4]||(t[4]=(0,s.Lk)("div",{class:"col-md-4"},[(0,s.Lk)("strong",null,"Customer Organisation"),(0,s.Lk)("p",{class:"text-instructions"}," This field is optional. If this customer does not have any organisations attached, it will treat this customer as a freelancer. ")],-1)),(0,s.Lk)("div",l,[(0,s.Lk)("div",n,[t[3]||(t[3]=(0,s.Lk)("label",null,"Organisation:",-1)),(0,s.bF)(v,{options:h.organisationFixList,filterable:"",placeholder:"Search Organisations",onSearch:g.fetchOptions,value:h.organisationModel,"onUpdate:value":t[1]||(t[1]=e=>h.organisationModel=e),label:"organisation_name",class:"get-stakeholders"},null,8,["options","onSearch","value"])])])]),(0,s.Q3)(" REMEMBER TO ADD IN USER PERMISSIONS HERE!! "),(0,s.Q3)(" Submit Button "),t[9]||(t[9]=(0,s.Lk)("hr",null,null,-1)),(0,s.Lk)("div",u,[(0,s.Lk)("div",m,[(0,s.Lk)("button",{href:"javascript:void(0)",class:"btn btn-primary save-changes",onClick:t[2]||(t[2]=(...e)=>g.submitNewCustomer&&g.submitNewCustomer(...e)),disabled:h.disableSubmitButton},"Submit Customer",8,d)])])])])])),_:1},8,["theme"])}]])},3795:(e,t,a)=>{a.d(t,{A:()=>L});var s=a(641),o=a(3751);const i={class:"row"},r={class:"col-md-8"},l={class:"row"},n={class:"form-group col-sm-3"},u={class:"form-group col-sm-4"},m={class:"form-group col-sm-5"},d={class:"form-group col-sm-8 mt-4 mb-4"};var c=a(1080),h=a(9639),g=a(3855),p=a(404);const v={name:"NewCustomerForm",setup:()=>({v$:(0,h.Ay)()}),components:{NSelect:c.A,ValidationRendering:p.A},emits:["update_customer_data"],props:{flagValidationCheck:{type:Boolean,default:!1},titleList:{type:Array,default:()=>[]}},data:()=>({customerEmailModel:"",customerFirstNameModel:"",customerLastNameModel:"",organisationModel:{},searchTimeout:"",titleFixList:[],titleModel:[]}),validations:{customerEmailModel:{required:g.mw,email:g.Rp},customerFirstNameModel:{required:g.mw},customerLastNameModel:{required:g.mw},titleModel:{required:g.mw}},methods:{},watch:{customerEmailModel(){this.$emit("update_customer_data",{field:"customerEmailModel",value:this.customerEmailModel})},customerFirstNameModel(){this.$emit("update_customer_data",{field:"customerFirstNameModel",value:this.customerFirstNameModel})},customerLastNameModel(){this.$emit("update_customer_data",{field:"customerLastNameModel",value:this.customerLastNameModel})},flagValidationCheck(){this.flagValidationCheck&&this.v$.$touch()},titleModel(){this.$emit("update_customer_data",{field:"titleModel",value:this.titleModel})}},mounted(){this.titleFixList=this.titleList.map((e=>({value:e.pk,label:e.fields.title})))}},L=(0,a(6262).A)(v,[["render",function(e,t,a,c,h,g){const p=(0,s.g2)("validation-rendering"),v=(0,s.g2)("n-select");return(0,s.uX)(),(0,s.CE)("div",i,[t[8]||(t[8]=(0,s.Lk)("div",{class:"col-md-4"},[(0,s.Lk)("strong",null,"New Customer"),(0,s.Lk)("p",{class:"text-instructions"}," Please fill out the following details. "),(0,s.Lk)("strong",null,"Please Note:"),(0,s.Lk)("p",{class:"text-instructions"}," Customers do not go through a duplication process. Please search for the potential customer first before adding them into NearBeach. ")],-1)),(0,s.Lk)("div",r,[(0,s.Q3)(" CUSTOMER DETAILS "),(0,s.Lk)("div",l,[(0,s.Lk)("div",n,[(0,s.Lk)("label",null,[t[4]||(t[4]=(0,s.eW)(" Title: ")),(0,s.bF)(p,{"error-list":c.v$.titleModel.$errors},null,8,["error-list"])]),(0,s.bF)(v,{options:h.titleFixList,label:"title",placeholder:"",value:h.titleModel,"onUpdate:value":t[0]||(t[0]=e=>h.titleModel=e)},null,8,["options","value"])]),(0,s.Lk)("div",u,[(0,s.Lk)("label",null,[t[5]||(t[5]=(0,s.eW)(" First Name: ")),(0,s.bF)(p,{"error-list":c.v$.customerFirstNameModel.$errors},null,8,["error-list"])]),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>h.customerFirstNameModel=e)},null,512),[[o.vModelText,h.customerFirstNameModel]])]),(0,s.Lk)("div",m,[(0,s.Lk)("label",null,[t[6]||(t[6]=(0,s.eW)(" Last Name: ")),(0,s.bF)(p,{"error-list":c.v$.customerLastNameModel.$errors},null,8,["error-list"])]),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>h.customerLastNameModel=e)},null,512),[[o.vModelText,h.customerLastNameModel]])])]),(0,s.Q3)(" Customer Email "),(0,s.Lk)("div",d,[(0,s.Lk)("label",null,[t[7]||(t[7]=(0,s.eW)(" Email: ")),(0,s.bF)(p,{"error-list":c.v$.customerEmailModel.$errors},null,8,["error-list"])]),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>h.customerEmailModel=e)},null,512),[[o.vModelText,h.customerEmailModel]])])])])}]])},404:(e,t,a)=>{a.d(t,{A:()=>r});var s=a(641),o=a(33);const i={name:"ValidationRendering",props:{errorList:{type:Array,default:()=>[]}}},r=(0,a(6262).A)(i,[["render",function(e,t,a,i,r,l){return(0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.errorList,(e=>((0,s.uX)(),(0,s.CE)("span",{class:"error",key:e.$uid},(0,o.toDisplayString)(e.$message),1)))),128)}]])},9581:(e,t,a)=>{a.d(t,{p:()=>i});var s=a(953),o=a(7413);function i(e){return"dark"===(0,s.BA)(e)?o.a:null}}}]);