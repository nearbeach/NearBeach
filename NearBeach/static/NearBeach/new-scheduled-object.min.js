"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[8727],{6284:(e,t,o)=>{o.r(t),o.d(t,{default:()=>$});var s=o(641),r=o(3751);const l={class:"card"},i={class:"card card-body"},a=["href"],d={class:"row"},n={class:"col-md-8"},u={class:"row"},c={class:"col-md-8",style:{"min-height":"610px"}},p={class:"form-group"},h=["src"],g={class:"row submit-row"},m={class:"col-md-12"};var b=o(8838),y=o(3913),k=o(1080),M=o(3651),f=o(2764),v=o(2190),_=o(3364),j=o(9827),L=o(379),w=o(9639),D=o(3855),T=o(404),S=o(2124);const O={name:"NewScheduledObject",setup:()=>({v$:(0,w.Ay)()}),components:{BetweenDates:M.A,editor:b.A,GetStakeholders:f.A,GroupPermissions:v.A,NConfigProvider:y.A,NSelect:k.A,SchedulerFrequency:_.A,ValidationRendering:T.A},props:{groupResults:{type:Array,default:()=>[]},rootUrl:{type:String,default:"/"},staticUrl:{type:String,default:"/"},theme:{type:String,default:"light"},userGroupPermissions:{type:Array,default:()=>[]},uuid:{type:String,default:""}},data:()=>({groupModel:{},groupModelValidation:!0,displayGroupPermissionIssue:!1,objectDescriptionModel:"",objectEndDateModel:"",objectStartDateModel:"",objectTitleModel:"",objectTypeModel:"",objectTypeOptions:[{value:0,label:"Project"},{value:1,label:"Task"}],stakeholderModel:"",daysBeforeModel:0,dayModel:[],endDateConditionModel:"no-end-date",endDateModel:0,isFormValid:!1,numberOfRepeats:0,schedulerFrequencyModel:"Set Day of the Week",singleDayModel:"monday",startDateModel:0}),computed:{...(0,S.L8)({contentCss:"getContentCss",skin:"getSkin"})},validations:{groupModel:{required:D.mw},objectDescriptionModel:{required:D.mw},objectTitleModel:{required:D.mw},objectTypeModel:{required:D.mw},stakeholderModel:{required:D.mw}},mixins:[j.A,L.A],methods:{calculateUserLevel(e){if(0===e.length)return 0;const t=e.reduce(((e,t)=>e&&e.project_permission>t.project_permission?e:t)).project_permission,o=e.reduce(((e,t)=>e&&e.task_permission>t.task_permission?e:t)).task_permission;return o>t?o:t},submitNewScheduledObject:async function(){if(!await this.v$.$validate()||this.displayGroupPermissionIssue||!this.isFormValid)return void this.$store.dispatch("newToast",{header:"Please check all validation",message:"There are some fields that are filled in correctly. Please correct these mistakes.",extra_classes:"bg-danger",delay:0});if(!this.groupModelValidation)return void this.$store.dispatch("newToast",{header:"No CREATE permission for groups",message:"Please note - for the current groups selected, you do not have create permissions. Please add in a group you have create permission with.",extra_classes:"bg-danger",delay:5e3});const e=new FormData;e.set("object_type",this.objectTypeModel),e.set("object_title",this.objectTitleModel),e.set("object_description",this.objectDescriptionModel),e.set("organisation",this.stakeholderModel),e.set("object_start_date",this.objectStartDateModel.toISOString()),e.set("object_end_date",this.objectEndDateModel.toISOString()),e.set("uuid",this.uuid),this.groupModel.forEach((t=>{e.append("group_list",t)}));const t=(new Date).getTimezoneOffset();let o=new Date(this.endDateModel-60*t*1e3),s=new Date(this.startDateModel-60*t*1e3);o=o.toISOString().split("T")[0],s=s.toISOString().split("T")[0],e.set("days_before",this.daysBeforeModel),e.set("number_of_repeats",this.numberOfRepeats),e.set("scheduler_frequency",this.schedulerFrequencyModel),e.set("scheduler_end_date",o),e.set("scheduler_start_date",s),e.set("single_day",this.singleDayModel),e.set("end_date_condition",this.endDateConditionModel),this.dayModel.forEach((t=>{e.append("day",t)})),this.axios.post(`${this.rootUrl}new_scheduled_object/save/`,e).then((e=>{const t=e.data.scheduled_object_id;window.location.href=`${this.rootUrl}scheduled_object_information/${t}`})).catch((e=>{this.$store.dispatch("newToast",{header:"Error creating new scheduled object",message:`Sorry, we could not create this scheduled object for you. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))},updateDates(e){this.objectStartDateModel=new Date(e.start_date),this.objectEndDateModel=new Date(e.end_date)},updateGroupModel(e){this.groupModel=e,this.displayGroupPermissionIssue=0===this.userGroupPermissions.filter((e=>{const t=this.groupModel.includes(e.group_id),o=e.object_permission_value>=3;return t&&o})).length},updateSchedulerFrequency(e){this.daysBeforeModel=e.daysBeforeModel,this.dayModel=e.dayModel,this.endDateConditionModel=e.endDateConditionModel,this.endDateModel=e.endDateModel,this.isFormValid=e.isFormValid,this.numberOfRepeats=e.numberOfRepeatsModel,this.schedulerFrequencyModel=e.schedulerFrequencyModel,this.singleDayModel=e.singleDayModel,this.startDateModel=e.startDateModel},updateStakeholderModel(e){this.stakeholderModel=e}},async beforeMount(){await this.$store.dispatch("processThemeUpdate",{theme:this.theme})},mounted(){this.$store.commit({type:"updateUrl",rootUrl:this.rootUrl,staticUrl:this.staticUrl});const e=this.calculateUserLevel(this.userGroupPermissions);this.$store.commit({type:"updateUserLevel",userLevel:e})}},$=(0,o(6262).A)(O,[["render",function(e,t,o,b,y,k){const M=(0,s.g2)("validation-rendering"),f=(0,s.g2)("n-select"),v=(0,s.g2)("editor"),_=(0,s.g2)("get-stakeholders"),j=(0,s.g2)("between-dates"),L=(0,s.g2)("group-permissions"),w=(0,s.g2)("scheduler-frequency"),D=(0,s.g2)("n-config-provider");return(0,s.uX)(),(0,s.Wv)(D,{theme:e.getTheme(o.theme)},{default:(0,s.k6)((()=>[(0,s.Lk)("div",l,[(0,s.Lk)("div",i,[t[14]||(t[14]=(0,s.Lk)("h1",null,"New Scheduled Object",-1)),(0,s.Lk)("a",{href:`${o.rootUrl}scheduled_objects/`},"Back to Scheduled Object list",8,a),t[15]||(t[15]=(0,s.Lk)("hr",null,null,-1)),(0,s.Lk)("div",d,[t[8]||(t[8]=(0,s.Lk)("div",{class:"col-md-4"},[(0,s.Lk)("h2",null,"Object Type"),(0,s.Lk)("p",{class:"text-instructions"}," Please select if the object will be either a Project or Task. ")],-1)),(0,s.Lk)("div",n,[(0,s.Lk)("label",null,[t[7]||(t[7]=(0,s.eW)(" Object Type ")),(0,s.bF)(M,{"error-list":b.v$.objectTypeModel.$errors},null,8,["error-list"])]),(0,s.bF)(f,{value:y.objectTypeModel,"onUpdate:value":t[0]||(t[0]=e=>y.objectTypeModel=e),options:y.objectTypeOptions},null,8,["value","options"])])]),(0,s.Q3)(" OBJECT DESCRIPTION"),t[16]||(t[16]=(0,s.Lk)("hr",null,null,-1)),(0,s.Lk)("div",u,[t[13]||(t[13]=(0,s.Lk)("div",{class:"col-md-4"},[(0,s.Lk)("h2",null,"Description"),(0,s.Lk)("p",{class:"text-instructions"}," Please supply a suitable Title and Description for your object. This will be created exactly each time the object is created. ")],-1)),(0,s.Lk)("div",c,[(0,s.Lk)("div",p,[(0,s.Lk)("label",null,[t[9]||(t[9]=(0,s.eW)("Object Title ")),(0,s.bF)(M,{"error-list":b.v$.objectTitleModel.$errors},null,8,["error-list"])]),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>y.objectTitleModel=e),class:"form-control"},null,512),[[r.vModelText,y.objectTitleModel]])]),t[11]||(t[11]=(0,s.Lk)("br",null,null,-1)),(0,s.Q3)(" OBJECT DESCRIPTION "),(0,s.Lk)("label",null,[t[10]||(t[10]=(0,s.eW)(" Object Description: ")),(0,s.bF)(M,{"error-list":b.v$.objectDescriptionModel.$errors},null,8,["error-list"])]),t[12]||(t[12]=(0,s.Lk)("br",null,null,-1)),(0,s.Lk)("img",{src:`${o.staticUrl}NearBeach/images/placeholder/body_text.svg`,class:"loader-image",alt:"loading image for Tinymce"},null,8,h),(0,s.bF)(v,{init:{file_picker_types:"image",height:500,images_upload_handler:e.newObjectUploadImage,menubar:!1,paste_data_images:!0,plugins:["lists","image","codesample","table"],toolbar:"undo redo | blocks | bold italic strikethrough underline backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | table image codesample",skin:`${this.skin}`,content_css:`${this.contentCss}`},modelValue:y.objectDescriptionModel,"onUpdate:modelValue":t[2]||(t[2]=e=>y.objectDescriptionModel=e)},null,8,["init","modelValue"])])]),(0,s.Q3)(" STAKEHOLDER ORGANISATION "),t[17]||(t[17]=(0,s.Lk)("hr",null,null,-1)),(0,s.bF)(_,{onUpdate_stakeholder_model:t[3]||(t[3]=e=>k.updateStakeholderModel(e)),"is-dirty":b.v$.stakeholderModel.$dirty},null,8,["is-dirty"]),(0,s.Q3)(" START DATE & END DATE "),t[18]||(t[18]=(0,s.Lk)("hr",null,null,-1)),(0,s.bF)(j,{destination:"object",onUpdate_dates:t[4]||(t[4]=e=>k.updateDates(e))}),(0,s.Q3)(" Group Permissions "),t[19]||(t[19]=(0,s.Lk)("hr",null,null,-1)),(0,s.bF)(L,{"display-group-permission-issue":y.displayGroupPermissionIssue,"group-results":o.groupResults,"user-group-permissions":o.userGroupPermissions,onUpdate_group_model:t[5]||(t[5]=e=>k.updateGroupModel(e)),"is-dirty":b.v$.groupModel.$dirty,destination:"object"},null,8,["display-group-permission-issue","group-results","user-group-permissions","is-dirty"]),(0,s.Q3)(" Scheduler Frequency "),t[20]||(t[20]=(0,s.Lk)("hr",null,null,-1)),(0,s.bF)(w,{onUpdate_scheduler_frequency:k.updateSchedulerFrequency},null,8,["onUpdate_scheduler_frequency"]),(0,s.Q3)(" Submit Button "),t[21]||(t[21]=(0,s.Lk)("hr",null,null,-1)),(0,s.Lk)("div",g,[(0,s.Lk)("div",m,[(0,s.Lk)("button",{class:"btn btn-primary save-changes",onClick:t[6]||(t[6]=(...e)=>k.submitNewScheduledObject&&k.submitNewScheduledObject(...e))}," Create new Project ")])])])])])),_:1},8,["theme"])}]])},2764:(e,t,o)=>{o.d(t,{A:()=>b});var s=o(641);const r={class:"row"},l={class:"col-md-4"},i={class:"text-instructions"},a=["href"],d={class:"col-md-8"},n={class:"form-group"};var u=o(1080),c=o(2124),p=o(9639),h=o(3855),g=o(404);const m={name:"GetStakeholders",setup:()=>({v$:(0,p.Ay)()}),components:{NSelect:u.A,ValidationRendering:g.A},emits:["update_stakeholder_model"],props:{},data:()=>({searchTimeout:"",stakeholderFixList:[],stakeholderModel:""}),validations:{stakeholderModel:{required:h.mw}},computed:{...(0,c.L8)({rootUrl:"getRootUrl"})},methods:{fetchOptions(e,t){""!==this.searchTimeout&&clearTimeout(this.searchTimeout),e.length>=3&&(this.searchTimeout=setTimeout((()=>{this.getOrganisationData(e,t)}),500))},getOrganisationData(e){const t=new FormData;t.set("search",e),this.axios.post(`${this.rootUrl}search/organisation/data/`,t).then((e=>{const t=e.data;this.stakeholderFixList=t.map((e=>({value:e.pk,label:e.fields.organisation_name})))})).catch((e=>{this.$store.dispatch("newToast",{header:"Error getting organisation data",message:`Error getting the organisation data. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))}},watch:{stakeholderModel(){this.$emit("update_stakeholder_model",this.stakeholderModel)}},mounted(){this.$nextTick((()=>{this.getOrganisationData("","")}))}},b=(0,o(6262).A)(m,[["render",function(e,t,o,u,c,p){const h=(0,s.g2)("validation-rendering"),g=(0,s.g2)("n-select");return(0,s.uX)(),(0,s.CE)("div",r,[(0,s.Lk)("div",l,[t[3]||(t[3]=(0,s.Lk)("h2",null,"Stakeholder Organisation",-1)),t[4]||(t[4]=(0,s.Lk)("p",{class:"text-instructions"}," Please search for your stakeholder's organisation in the dropdown box. Once found, please select. ",-1)),(0,s.Lk)("p",i,[t[1]||(t[1]=(0,s.eW)(" If you can not find your organisation, please ")),(0,s.Lk)("a",{href:`${e.rootUrl}new_organisation/`,target:"_blank",rel:"noopener noreferrer"}," click here to create it. ",8,a),t[2]||(t[2]=(0,s.eW)(" Then search for it again "))])]),(0,s.Lk)("div",d,[(0,s.Lk)("div",n,[(0,s.Lk)("label",null,[t[5]||(t[5]=(0,s.eW)("Stakeholder Organisation ")),(0,s.bF)(h,{"error-list":u.v$.stakeholderModel.$errors},null,8,["error-list"])]),(0,s.bF)(g,{options:c.stakeholderFixList,filterable:"",placeholder:"Search Stakeholders",onSearch:p.fetchOptions,value:c.stakeholderModel,"onUpdate:value":t[0]||(t[0]=e=>c.stakeholderModel=e),label:"organisation_name",class:"get-stakeholders"},null,8,["options","onSearch","value"])])])])}]])},2190:(e,t,o)=>{o.d(t,{A:()=>m});var s=o(641),r=o(33);const l={class:"row"},i={class:"col-md-4"},a={class:"text-instructions"},d={class:"col-md-8"},n={key:0,class:"alert alert-warning"};var u=o(1080),c=o(9639),p=o(3855),h=o(404);const g={name:"GroupPermissions",setup:()=>({v$:(0,c.Ay)()}),components:{NSelect:u.A,ValidationRendering:h.A},emits:["update_group_model"],props:{destination:{type:String,default:""},displayGroupPermissionIssue:{type:Boolean,default:!1},groupResults:{type:Array,default:()=>[]},userGroupPermissions:{type:Array,default:()=>[]}},watch:{groupModel(){this.$emit("update_group_model",this.groupModel)}},data:()=>({groupModel:[]}),validations:{groupModel:{required:p.mw}},mounted(){this.groupModel=this.userGroupPermissions.map((e=>e.group_id))}},m=(0,o(6262).A)(g,[["render",function(e,t,o,u,c,p){const h=(0,s.g2)("validation-rendering"),g=(0,s.g2)("n-select");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",i,[t[1]||(t[1]=(0,s.Lk)("h2",null,"Group Permissions",-1)),(0,s.Lk)("p",a," Add or remove groups from this "+(0,r.toDisplayString)(o.destination)+". Adding a group will allow users from that group to access this "+(0,r.toDisplayString)(o.destination)+". ",1),t[2]||(t[2]=(0,s.Lk)("p",{class:"text-instructions"}," If you do not add one of your own group(s), you will only get readonly access. ",-1))]),(0,s.Lk)("div",d,[(0,s.Lk)("label",null,[t[3]||(t[3]=(0,s.eW)("Group List ")),(0,s.bF)(h,{"error-list":u.v$.groupModel.$errors},null,8,["error-list"])]),(0,s.bF)(g,{options:o.groupResults,"label-field":"group_name","value-field":"group_id",label:"group",value:c.groupModel,"onUpdate:value":t[0]||(t[0]=e=>c.groupModel=e),multiple:""},null,8,["options","value"]),(0,s.Q3)(" ALERT FOR WHEN USER GROUPS ARE NOT INCLUDED "),t[4]||(t[4]=(0,s.Lk)("br",null,null,-1)),o.displayGroupPermissionIssue?((0,s.uX)(),(0,s.CE)("div",n," You currently don't have enough permissions to create this object. Please select groups where you have the create ability. ")):(0,s.Q3)("v-if",!0)])])}]])}}]);