"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[8727],{8078:(e,t,o)=>{o.r(t),o.d(t,{default:()=>q});var s=o(641),r=o(3751);const l={class:"card"},i={class:"card card-body"},a=(0,s.Lk)("h1",null,"New Scheduled Object",-1),d=["href"],n=(0,s.Lk)("hr",null,null,-1),u={class:"row"},c=(0,s.Lk)("div",{class:"col-md-4"},[(0,s.Lk)("h2",null,"Object Type"),(0,s.Lk)("p",{class:"text-instructions"}," Please select if the object will be either a Project or Task. ")],-1),p={class:"col-md-8"},h=(0,s.Lk)("hr",null,null,-1),g={class:"row"},m=(0,s.Lk)("div",{class:"col-md-4"},[(0,s.Lk)("h2",null,"Description"),(0,s.Lk)("p",{class:"text-instructions"}," Please supply a suitable Title and Description for your object. This will be created exactly each time the object is created. ")],-1),b={class:"col-md-8",style:{"min-height":"610px"}},y={class:"form-group"},k=(0,s.Lk)("br",null,null,-1),M=(0,s.Lk)("br",null,null,-1),f=["src"],v=(0,s.Lk)("hr",null,null,-1),_=(0,s.Lk)("hr",null,null,-1),j=(0,s.Lk)("hr",null,null,-1),L=(0,s.Lk)("hr",null,null,-1),w=(0,s.Lk)("hr",null,null,-1),D={class:"row submit-row"},T={class:"col-md-12"};var S=o(8838),O=o(3913),$=o(1080),A=o(6894),U=o(2764),F=o(2190),P=o(6741),E=o(9639),N=o(3855),G=o(404),R=o(2124),x=o(9581),C=o(9184);const I={name:"NewScheduledObject",setup:()=>({v$:(0,E.Ay)()}),components:{BetweenDates:A.A,editor:S.A,GetStakeholders:U.A,GroupPermissions:F.A,NConfigProvider:O.A,NSelect:$.A,SchedulerFrequency:P.A,ValidationRendering:G.A},props:{groupResults:{type:Array,default:()=>[]},rootUrl:{type:String,default:"/"},staticUrl:{type:String,default:"/"},theme:{type:String,default:"light"},userGroupPermissions:{type:Array,default:()=>[]},uuid:{type:String,default:""}},data:()=>({groupModel:{},groupModelValidation:!0,displayGroupPermissionIssue:!1,objectDescriptionModel:"",objectEndDateModel:"",objectStartDateModel:"",objectTitleModel:"",objectTypeModel:"",objectTypeOptions:[{value:0,label:"Project"},{value:1,label:"Task"}],stakeholderModel:"",daysBeforeModel:0,dayModel:[],endDateConditionModel:"no-end-date",endDateModel:0,isFormValid:!1,numberOfRepeats:0,schedulerFrequencyModel:"Set Day of the Week",singleDayModel:"monday",startDateModel:0}),computed:{...(0,R.L8)({contentCss:"getContentCss",skin:"getSkin"})},validations:{groupModel:{required:N.mw},objectDescriptionModel:{required:N.mw},objectTitleModel:{required:N.mw},objectTypeModel:{required:N.mw},stakeholderModel:{required:N.mw}},methods:{useNewObjectUploadImage:C.j,useNBTheme:x.p,calculateUserLevel(e){if(0===e.length)return 0;const t=e.reduce(((e,t)=>e&&e.project_permission>t.project_permission?e:t)).project_permission,o=e.reduce(((e,t)=>e&&e.task_permission>t.task_permission?e:t)).task_permission;return o>t?o:t},async submitNewScheduledObject(){if(!await this.v$.$validate()||this.displayGroupPermissionIssue||!this.isFormValid)return void this.$store.dispatch("newToast",{header:"Please check all validation",message:"There are some fields that are filled in correctly. Please correct these mistakes.",extra_classes:"bg-danger",delay:0});if(!this.groupModelValidation)return void this.$store.dispatch("newToast",{header:"No CREATE permission for groups",message:"Please note - for the current groups selected, you do not have create permissions. Please add in a group you have create permission with.",extra_classes:"bg-danger",delay:5e3});const e=new FormData;e.set("object_type",this.objectTypeModel),e.set("object_title",this.objectTitleModel),e.set("object_description",this.objectDescriptionModel),e.set("organisation",this.stakeholderModel),e.set("object_start_date",this.objectStartDateModel.toISOString()),e.set("object_end_date",this.objectEndDateModel.toISOString()),e.set("uuid",this.uuid),this.groupModel.forEach((t=>{e.append("group_list",t)}));const t=(new Date).getTimezoneOffset();let o=new Date(this.endDateModel-60*t*1e3),s=new Date(this.startDateModel-60*t*1e3);o=o.toISOString().split("T")[0],s=s.toISOString().split("T")[0],e.set("days_before",this.daysBeforeModel),e.set("number_of_repeats",this.numberOfRepeats),e.set("scheduler_frequency",this.schedulerFrequencyModel),e.set("scheduler_end_date",o),e.set("scheduler_start_date",s),e.set("single_day",this.singleDayModel),e.set("end_date_condition",this.endDateConditionModel),this.dayModel.forEach((t=>{e.append("day",t)})),this.axios.post(`${this.rootUrl}new_scheduled_object/save/`,e).then((e=>{const t=e.data.scheduled_object_id;window.location.href=`${this.rootUrl}scheduled_object_information/${t}`})).catch((e=>{this.$store.dispatch("newToast",{header:"Error creating new scheduled object",message:`Sorry, we could not create this scheduled object for you. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))},updateDates(e){this.objectStartDateModel=new Date(e.start_date),this.objectEndDateModel=new Date(e.end_date)},updateGroupModel(e){this.groupModel=e,this.displayGroupPermissionIssue=0===this.userGroupPermissions.filter((e=>{const t=this.groupModel.includes(e.group_id),o=e.object_permission_value>=3;return t&&o})).length},updateSchedulerFrequency(e){this.daysBeforeModel=e.daysBeforeModel,this.dayModel=e.dayModel,this.endDateConditionModel=e.endDateConditionModel,this.endDateModel=e.endDateModel,this.isFormValid=e.isFormValid,this.numberOfRepeats=e.numberOfRepeatsModel,this.schedulerFrequencyModel=e.schedulerFrequencyModel,this.singleDayModel=e.singleDayModel,this.startDateModel=e.startDateModel},updateStakeholderModel(e){this.stakeholderModel=e}},async beforeMount(){await this.$store.dispatch("processThemeUpdate",{theme:this.theme})},mounted(){this.$store.commit({type:"updateUrl",rootUrl:this.rootUrl,staticUrl:this.staticUrl});const e=this.calculateUserLevel(this.userGroupPermissions);this.$store.commit({type:"updateUserLevel",userLevel:e})}},q=(0,o(6262).A)(I,[["render",function(e,t,o,S,O,$){const A=(0,s.g2)("validation-rendering"),U=(0,s.g2)("n-select"),F=(0,s.g2)("editor"),P=(0,s.g2)("get-stakeholders"),E=(0,s.g2)("between-dates"),N=(0,s.g2)("group-permissions"),G=(0,s.g2)("scheduler-frequency"),R=(0,s.g2)("n-config-provider");return(0,s.uX)(),(0,s.Wv)(R,{theme:$.useNBTheme(o.theme)},{default:(0,s.k6)((()=>[(0,s.Lk)("div",l,[(0,s.Lk)("div",i,[a,(0,s.Lk)("a",{href:`${o.rootUrl}scheduled_objects/`},"Back to Scheduled Object list",8,d),n,(0,s.Lk)("div",u,[c,(0,s.Lk)("div",p,[(0,s.Lk)("label",null,[(0,s.eW)(" Object Type "),(0,s.bF)(A,{"error-list":S.v$.objectTypeModel.$errors},null,8,["error-list"])]),(0,s.bF)(U,{value:O.objectTypeModel,"onUpdate:value":t[0]||(t[0]=e=>O.objectTypeModel=e),options:O.objectTypeOptions},null,8,["value","options"])])]),(0,s.Q3)(" OBJECT DESCRIPTION"),h,(0,s.Lk)("div",g,[m,(0,s.Lk)("div",b,[(0,s.Lk)("div",y,[(0,s.Lk)("label",null,[(0,s.eW)("Object Title "),(0,s.bF)(A,{"error-list":S.v$.objectTitleModel.$errors},null,8,["error-list"])]),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>O.objectTitleModel=e),class:"form-control"},null,512),[[r.vModelText,O.objectTitleModel]])]),k,(0,s.Q3)(" OBJECT DESCRIPTION "),(0,s.Lk)("label",null,[(0,s.eW)(" Object Description: "),(0,s.bF)(A,{"error-list":S.v$.objectDescriptionModel.$errors},null,8,["error-list"])]),M,(0,s.Lk)("img",{src:`${o.staticUrl}NearBeach/images/placeholder/body_text.svg`,class:"loader-image",alt:"loading image for Tinymce"},null,8,f),(0,s.bF)(F,{"license-key":"gpl",init:{file_picker_types:"image",height:500,images_upload_handler:$.useNewObjectUploadImage,menubar:!1,paste_data_images:!0,plugins:["lists","image","codesample","table"],toolbar:"undo redo | blocks | bold italic strikethrough underline backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | table image codesample",skin:`${this.skin}`,content_css:`${this.contentCss}`,relative_urls:!1},modelValue:O.objectDescriptionModel,"onUpdate:modelValue":t[2]||(t[2]=e=>O.objectDescriptionModel=e)},null,8,["init","modelValue"])])]),(0,s.Q3)(" STAKEHOLDER ORGANISATION "),v,(0,s.bF)(P,{onUpdate_stakeholder_model:t[3]||(t[3]=e=>$.updateStakeholderModel(e)),"is-dirty":S.v$.stakeholderModel.$dirty},null,8,["is-dirty"]),(0,s.Q3)(" START DATE & END DATE "),_,(0,s.bF)(E,{destination:"object",onUpdate_dates:t[4]||(t[4]=e=>$.updateDates(e))}),(0,s.Q3)(" Group Permissions "),j,(0,s.bF)(N,{"display-group-permission-issue":O.displayGroupPermissionIssue,"group-results":o.groupResults,"user-group-permissions":o.userGroupPermissions,onUpdate_group_model:t[5]||(t[5]=e=>$.updateGroupModel(e)),"is-dirty":S.v$.groupModel.$dirty,destination:"object"},null,8,["display-group-permission-issue","group-results","user-group-permissions","is-dirty"]),(0,s.Q3)(" Scheduler Frequency "),L,(0,s.bF)(G,{onUpdate_scheduler_frequency:$.updateSchedulerFrequency},null,8,["onUpdate_scheduler_frequency"]),(0,s.Q3)(" Submit Button "),w,(0,s.Lk)("div",D,[(0,s.Lk)("div",T,[(0,s.Lk)("button",{class:"btn btn-primary save-changes",onClick:t[6]||(t[6]=(...e)=>$.submitNewScheduledObject&&$.submitNewScheduledObject(...e))}," Create New Scheduled Object ")])])])])])),_:1},8,["theme"])}]])},2764:(e,t,o)=>{o.d(t,{A:()=>k});var s=o(641);const r={class:"row"},l={class:"col-md-4"},i=(0,s.Lk)("h2",null,"Stakeholder Organisation",-1),a=(0,s.Lk)("p",{class:"text-instructions"}," Please search for your stakeholder's organisation in the dropdown box. Once found, please select. ",-1),d={class:"text-instructions"},n=["href"],u={class:"col-md-8"},c={class:"form-group"};var p=o(1080),h=o(2124),g=o(9639),m=o(3855),b=o(404);const y={name:"GetStakeholders",setup:()=>({v$:(0,g.Ay)()}),components:{NSelect:p.A,ValidationRendering:b.A},emits:["update_stakeholder_model"],props:{},data:()=>({searchTimeout:"",stakeholderFixList:[],stakeholderModel:""}),validations:{stakeholderModel:{required:m.mw}},computed:{...(0,h.L8)({rootUrl:"getRootUrl"})},methods:{fetchOptions(e,t){""!==this.searchTimeout&&clearTimeout(this.searchTimeout),e.length>=3&&(this.searchTimeout=setTimeout((()=>{this.getOrganisationData(e,t)}),500))},getOrganisationData(e){const t=new FormData;t.set("search",e),this.axios.post(`${this.rootUrl}search/organisation/data/`,t).then((e=>{const t=e.data;this.stakeholderFixList=t.map((e=>({value:e.pk,label:e.fields.organisation_name})))})).catch((e=>{this.$store.dispatch("newToast",{header:"Error getting organisation data",message:`Error getting the organisation data. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))}},watch:{stakeholderModel(){this.$emit("update_stakeholder_model",this.stakeholderModel)}},mounted(){this.$nextTick((()=>{this.getOrganisationData("","")}))}},k=(0,o(6262).A)(y,[["render",function(e,t,o,p,h,g){const m=(0,s.g2)("validation-rendering"),b=(0,s.g2)("n-select");return(0,s.uX)(),(0,s.CE)("div",r,[(0,s.Lk)("div",l,[i,a,(0,s.Lk)("p",d,[(0,s.eW)(" If you can not find your organisation, please "),(0,s.Lk)("a",{href:`${e.rootUrl}new_organisation/`,target:"_blank",rel:"noopener noreferrer"}," click here to create it. ",8,n),(0,s.eW)(" Then search for it again ")])]),(0,s.Lk)("div",u,[(0,s.Lk)("div",c,[(0,s.Lk)("label",null,[(0,s.eW)("Stakeholder Organisation "),(0,s.bF)(m,{"error-list":p.v$.stakeholderModel.$errors},null,8,["error-list"])]),(0,s.bF)(b,{options:h.stakeholderFixList,filterable:"",placeholder:"Search Stakeholders",onSearch:g.fetchOptions,value:h.stakeholderModel,"onUpdate:value":t[0]||(t[0]=e=>h.stakeholderModel=e),label:"organisation_name",class:"get-stakeholders"},null,8,["options","onSearch","value"])])])])}]])},2190:(e,t,o)=>{o.d(t,{A:()=>k});var s=o(641),r=o(33);const l={class:"row"},i={class:"col-md-4"},a=(0,s.Lk)("h2",null,"Group Permissions",-1),d={class:"text-instructions"},n=(0,s.Lk)("p",{class:"text-instructions"}," If you do not add one of your own group(s), you will only get readonly access. ",-1),u={class:"col-md-8"},c=(0,s.Lk)("br",null,null,-1),p={key:0,class:"alert alert-warning"};var h=o(1080),g=o(9639),m=o(3855),b=o(404);const y={name:"GroupPermissions",setup:()=>({v$:(0,g.Ay)()}),components:{NSelect:h.A,ValidationRendering:b.A},emits:["update_group_model"],props:{destination:{type:String,default:""},displayGroupPermissionIssue:{type:Boolean,default:!1},groupResults:{type:Array,default:()=>[]},userGroupPermissions:{type:Array,default:()=>[]}},watch:{groupModel(){this.$emit("update_group_model",this.groupModel)}},data:()=>({groupModel:[]}),validations:{groupModel:{required:m.mw}},mounted(){this.groupModel=this.userGroupPermissions.map((e=>e.group_id))}},k=(0,o(6262).A)(y,[["render",function(e,t,o,h,g,m){const b=(0,s.g2)("validation-rendering"),y=(0,s.g2)("n-select");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",i,[a,(0,s.Lk)("p",d," Add or remove groups from this "+(0,r.toDisplayString)(o.destination)+". Adding a group will allow users from that group to access this "+(0,r.toDisplayString)(o.destination)+". ",1),n]),(0,s.Lk)("div",u,[(0,s.Lk)("label",null,[(0,s.eW)("Group List "),(0,s.bF)(b,{"error-list":h.v$.groupModel.$errors},null,8,["error-list"])]),(0,s.bF)(y,{options:o.groupResults,"label-field":"group_name","value-field":"group_id",label:"group",value:g.groupModel,"onUpdate:value":t[0]||(t[0]=e=>g.groupModel=e),multiple:""},null,8,["options","value"]),(0,s.Q3)(" ALERT FOR WHEN USER GROUPS ARE NOT INCLUDED "),c,o.displayGroupPermissionIssue?((0,s.uX)(),(0,s.CE)("div",p," You currently don't have enough permissions to create this object. Please select groups where you have the create ability. ")):(0,s.Q3)("v-if",!0)])])}]])}}]);