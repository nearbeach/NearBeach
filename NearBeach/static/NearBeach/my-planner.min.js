"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[9738],{2165:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ae});var s=a(641),o=a(33);const l={class:"my-planner"},r={class:"my-planner--header"},n={class:"text-instructions"},d={class:"my-planner--body"},i=["data-user-job-id","data-object-type","data-location-id"],c={key:0,class:"card-priority-line priority-normal"},u={class:"text-instructions"},b={class:"text-instructions"};var h=a(432),y=a.n(h),p=a(6285),m=a(9336);const k={class:"modal fade",id:"confirmUserJobDeleteModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false","aria-labelledby":"confirmUserJobDelete","aria-hidden":"true"},g={class:"modal-dialog"},j={class:"modal-content"},L={class:"modal-footer"};var f=a(2124);const v={name:"confirmUserJobDelete",emits:["remove_user_job"],props:{userJobId:{type:Number,default:0}},computed:{...(0,f.L8)({rootUrl:"getRootUrl"})},methods:{deleteUserJob(){const e=new FormData;e.set("user_job_id",`${this.userJobId}`),this.axios.post(`${this.rootUrl}my_planner/delete_user_job/`,e).then((()=>{this.$emit("remove_user_job",{})})).catch((e=>{this.$store.dispatch("newToast",{header:"Error removing user job from my planner",message:`We encounted an error removing user job from the planner. Error -> ${e}`,extra_classes:"bg-danger",delay:0})})),this.closeModal()},closeModal(){document.getElementById("confirmUserJobDeleteButton").click()}}};var _=a(6262);const M=(0,_.A)(v,[["render",function(e,t,a,o,l,r){return(0,s.uX)(),(0,s.CE)("div",k,[(0,s.Lk)("div",g,[(0,s.Lk)("div",j,[t[2]||(t[2]=(0,s.Lk)("div",{class:"modal-header"},[(0,s.Lk)("h5",{class:"modal-title",id:"confirmUserJobDelete"}," Please confirm User Job Deletion "),(0,s.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",id:"confirmUserJobDeleteButton"})],-1)),t[3]||(t[3]=(0,s.Lk)("div",{class:"modal-body"}," Are you sure you want to remove the current object from your planner? ",-1)),(0,s.Lk)("div",L,[(0,s.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[0]||(t[0]=(...e)=>r.closeModal&&r.closeModal(...e))}," No "),(0,s.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=(...e)=>r.deleteUserJob&&r.deleteUserJob(...e))}," Yes ")])])])])}]]);var w=a(3751);const C={class:"modal fade",id:"newPlannerObjectWizardModal",tabindex:"-1","aria-labelledby":"newPlannerObjectModel","aria-hidden":"true"},D={class:"modal-dialog modal-lg modal-fullscreen-lg-down"},S={class:"modal-content"},E={class:"modal-body"},T={class:"row"},I={class:"col-md-8"},U={key:1,class:"alert alert-success"},x={class:"row"},A={class:"col-md-8"},O={class:"row"},$={class:"col-md-6 mt-4"},F={class:"row"},R={class:"col-md-8"},P={key:0,class:"alert alert-info"},J={key:1,class:"alert alert-warning"},B={key:2,class:"form-group mb-4"},X={key:3,class:"wizard-results"},W={class:"wizard-results--card--tick"},N=["value","id"],Q={class:"wizard-results--card--content"},z={class:"text-instructions"},q={class:"text-instructions"},H={class:"modal-footer"},K=["disabled"],G={name:"NewPlannerObjectWizard",components:{NSelect:a(1080).A},emits:["update_date_array"],props:{dateArray:{type:Array,default:()=>[]}},computed:{...(0,f.L8)({rootUrl:"getRootUrl",staticUrl:"getStaticUrl"})},data:()=>({dayModel:"",filteredLinkModel:[],isSearching:!1,linkModel:[],listOfDays:[],objectModel:null,objectFilteredResults:[],objectResults:[],objectSelection:[{value:"kanban_card",label:"Kanban Card"},{value:"project",label:"Project"},{value:"task",label:"Task"}],searchTermModel:"----"}),methods:{getFilteredLinkModel(){const e=this.dateArray.filter((e=>e.date===this.dayModel));if(0===e.length)return;let t=e[0].data;this.filteredLinkModel=this.linkModel.filter((e=>0===t.filter((t=>parseInt(t.location_id)===parseInt(e))).length))},getFilteredResults(){const e=this.dateArray.filter((e=>e.date===this.dayModel));if(0===e.length)return;let t=e[0].data;const a=this.objectResults.filter((e=>0===t.filter((t=>{const a=e.destination.toLowerCase()===t.object_type.toLowerCase(),s=parseInt(e.location_id)===parseInt(t.location_id);return a&&s})).length));""!==this.searchTermModel&&null!==this.searchTermModel?this.objectFilteredResults=a.filter((e=>e.title.toLowerCase().includes(this.searchTermModel.toLowerCase()))):this.objectFilteredResults=a},renderObjectId(e){switch(e.destination){case"kanban_card":return`Card${e.location_id}`;case"project":return`Pro${e.location_id}`;case"task":return`Task${e.location_id}`;default:return"----"}},saveLinks(){if(0===this.filteredLinkModel.length)return;this.$store.dispatch("newToast",{header:"Currenty updating your Planner",message:"Currently updating your planner. Please wait",extra_classes:"bg-warning",delay:0,unique_type:"add-objects-to-planner"});const e=new FormData;e.set("destination",this.objectModel),this.filteredLinkModel.forEach((t=>{e.append(this.objectModel,t)})),e.set("job_date",this.dayModel),this.axios.post(`${this.rootUrl}my_planner/add_object/`,e).then((e=>{this.$emit("update_date_array",e.data),this.objectModel=null,document.getElementById("newPlannerObjectButton").click(),this.$store.dispatch("newToast",{header:"Updated your Planner",message:"We have successfully updated your planner",extra_classes:"bg-success",unique_type:"add-objects-to-planner"})})).catch((e=>{this.$store.dispatch("newToast",{header:"Error adding objects to your planner",message:`Sorry we could not add any objects to your planner. ${e}`,extra_classes:"bg-danger",delay:0,unique_type:"add-objects-to-planner"})}))}},watch:{dateArray:{handler(){this.getFilteredLinkModel(),this.getFilteredResults()},deep:!0},dayModel(){this.getFilteredLinkModel(),this.getFilteredResults()},linkModel:{handler(){this.getFilteredLinkModel()},deep:!0},objectModel(){this.linkModel=[],this.getFilteredLinkModel(),null!==this.objectModel?(this.isSearching=!0,this.axios.post(`${this.rootUrl}my_planner/get_object_list/${this.objectModel}/`).then((e=>{this.objectResults=e.data,this.objectFilteredResults=e.data,this.isSearching=!1,this.searchTermModel=""})).catch((e=>{this.$store.dispatch("newToast",{header:"Error Getting Object List",message:`We had an issue getting Object List. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))):this.isSearching=!1},searchTermModel(){this.getFilteredResults()}},mounted(){const e=p.c9.now();for(let t=0;t<7;t++){const a=e.plus({days:t}),s=a.toFormat("yyyy-LL-dd"),o=a.toFormat("cccc");this.listOfDays.push({label:`${o} - ${s}`,value:s})}this.dayModel=this.listOfDays[0].value}},Y=(0,_.A)(G,[["render",function(e,t,a,l,r,n){const d=(0,s.g2)("n-select");return(0,s.uX)(),(0,s.CE)("div",C,[(0,s.Lk)("div",D,[(0,s.Lk)("div",S,[t[14]||(t[14]=(0,s.Lk)("div",{class:"modal-header"},[(0,s.Lk)("h2",null," New Planner Object Wizard "),(0,s.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",id:"newPlannerObjectButton"},[(0,s.Lk)("span",{"aria-hidden":"true"})])],-1)),(0,s.Lk)("div",E,[(0,s.Q3)(" CHOOSING A OBJECT TYPE "),(0,s.Lk)("div",T,[t[5]||(t[5]=(0,s.Lk)("div",{class:"col-md-4"},[(0,s.Lk)("strong",null,"Object Selector"),(0,s.Lk)("p",{class:"text-instructions"}," Please select which object you would like to link to this requirement. ")],-1)),(0,s.Lk)("div",I,[r.isSearching?((0,s.uX)(),(0,s.CE)("div",U," Searching for "+(0,o.toDisplayString)(r.objectModel)+"s ",1)):((0,s.uX)(),(0,s.Wv)(d,{key:0,options:r.objectSelection,value:r.objectModel,"onUpdate:value":t[0]||(t[0]=e=>r.objectModel=e),class:"object-selection"},null,8,["options","value"]))])]),(0,s.Q3)(" OBJECT LOCATION "),t[11]||(t[11]=(0,s.Lk)("hr",null,null,-1)),(0,s.Lk)("div",x,[t[7]||(t[7]=(0,s.Lk)("div",{class:"col-md-4"},[(0,s.Lk)("strong",null,"Select Day"),(0,s.Lk)("p",{class:"text-instructions"}," Select the appropriate day for this object. ")],-1)),(0,s.Lk)("div",A,[(0,s.Lk)("div",O,[(0,s.Lk)("div",$,[t[6]||(t[6]=(0,s.Lk)("label",null,"Day",-1)),(0,s.bF)(d,{options:r.listOfDays,label:"column",value:r.dayModel,"onUpdate:value":t[1]||(t[1]=e=>r.dayModel=e)},null,8,["options","value"])])])])]),(0,s.Q3)(" SELECTING WHICH OBJECTS TO LINK TO "),t[12]||(t[12]=(0,s.Lk)("hr",null,null,-1)),(0,s.Lk)("div",F,[t[10]||(t[10]=(0,s.Lk)("div",{class:"col-md-4"},[(0,s.Lk)("strong",null,"Select Links"),(0,s.Lk)("p",{class:"text-instructions"}," Please select which of the objects you want to connect to this requirement. ")],-1)),(0,s.Lk)("div",R,[(0,s.Q3)(" LOADING PLACEHOLDER "),r.isSearching||null==r.objectModel?((0,s.uX)(),(0,s.CE)("div",P," Please select the object type. ")):(0,s.Q3)("v-if",!0),0===r.objectResults.length&&null!=r.objectModel?((0,s.uX)(),(0,s.CE)("div",J," Sorry. It currently looks like there are no "+(0,o.toDisplayString)(this.objectModel)+"s assigned to you. Only assigned "+(0,o.toDisplayString)(this.objectModel)+"s will show up here. ",1)):(0,s.Q3)("v-if",!0),(0,s.Q3)(" SEARCH RESULTS "),!r.isSearching&&r.objectResults.length>0&&null!=r.objectModel?((0,s.uX)(),(0,s.CE)("div",B,[t[8]||(t[8]=(0,s.Lk)("label",null,"Search Terms",-1)),(0,s.bo)((0,s.Lk)("input",{id:"search_terms",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>r.searchTermModel=e),type:"text"},null,512),[[w.vModelText,r.searchTermModel]])])):(0,s.Q3)("v-if",!0),!r.isSearching&&r.objectFilteredResults.length>0&&null!=r.objectModel?((0,s.uX)(),(0,s.CE)("div",X,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.objectFilteredResults,(e=>((0,s.uX)(),(0,s.CE)("div",{class:"wizard-results--card",key:e.location_id},[(0,s.Lk)("div",W,[(0,s.bo)((0,s.Lk)("input",{class:"form-check-input",type:"checkbox",name:"link-option",value:e.location_id,id:`checkbox_${e.location_id}`,"onUpdate:modelValue":t[3]||(t[3]=e=>r.linkModel=e)},null,8,N),[[w.vModelCheckbox,r.linkModel]])]),(0,s.Lk)("div",Q,[(0,s.Lk)("div",z,(0,o.toDisplayString)(n.renderObjectId(e)),1),(0,s.Lk)("div",null,[(0,s.Lk)("strong",null,(0,o.toDisplayString)(e.title),1)]),(0,s.Lk)("div",null,[t[9]||(t[9]=(0,s.eW)(" Status: ")),(0,s.Lk)("span",q,(0,o.toDisplayString)(e.status),1)])])])))),128))])):(0,s.Q3)("v-if",!0)])])]),(0,s.Lk)("div",H,[t[13]||(t[13]=(0,s.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1)),(0,s.Lk)("button",{type:"button",class:"btn btn-primary",disabled:0===r.filteredLinkModel.length,onClick:t[4]||(t[4]=(...e)=>n.saveLinks&&n.saveLinks(...e))}," Save changes ",8,K)])])])])}]]);var V=a(3980),Z=a(246),ee=a(9581);const te={name:"MyPlanner",components:{CarbonTrashCan:V.dA,ConfirmUserJobDelete:M,draggable:y(),NewPlannerObjectWizard:Y},props:{rootUrl:{type:String,default:"/"},objectData:{type:Array,default:()=>[]},staticUrl:{type:String,default:"/"},theme:{type:String,default:""}},data:()=>({confirmIdToDelete:0,confirmIndex:0,dateArray:[]}),methods:{useNBTheme:ee.p,confirmCardDelete(e,t){this.confirmIdToDelete=e,this.confirmIndex=t,new m.aF(document.getElementById("confirmUserJobDeleteModal")).show()},getClass:e=>"Closed"===e?"text-decoration-line-through":"",formatObjectId(e){const t=(0,Z.y)(e.end_date);switch(e.object_type){case"kanban_card":return`Card${e.location_id}`;case"project":return`Pro${e.location_id} - ${t}`;case"task":return`Task${e.location_id} - ${t}`;default:return"----"}},move(e){const t=e.to,a=e.dragged.dataset.objectType,s=e.dragged.dataset.locationId;return!(this.dateArray.filter((e=>e.date===t.dataset.jobDate))[0].data.filter((e=>{const t=e.object_type.toLowerCase()===a.toLowerCase(),o=parseInt(e.location_id)===parseInt(s);return t&&o})).length>0&&(this.$store.dispatch("newToast",{header:"Object Already Exists",message:`Sorry, the ${a} already exists on ${t.dataset.jobDate}.`,extra_classes:"bg-info",unique_type:"move_planner_card",delay:1750}),1))},removeUserJob(){this.dateArray[this.confirmIndex].data=this.dateArray[this.confirmIndex].data.filter((e=>e.user_job_id!==this.confirmIdToDelete))},onEnd(e){const t=e.to,a=e.from,s=e.item.dataset.userJobId,o=new FormData;o.set("user_job_id",s),o.set("job_date",t.dataset.jobDate);const l=t.dataset.index,r=a.dataset.index;this.dateArray[l].data.forEach((e=>{o.append("new_destination",e.user_job_id)})),l!==r&&this.dateArray[r].data.forEach((e=>{o.append("old_destination",e.user_job_id)})),this.axios.post(`${this.rootUrl}my_planner/update_object_list/`,o).catch((e=>{this.$store.dispatch("newToast",{header:"Error updating my planner",message:`Sorry, we could not update your planner. ${e}`,extra_classes:"bg-danger",delay:0})}))},showModal(){new m.aF(document.getElementById("newPlannerObjectWizardModal")).show()},updateDateArray(e){this.dateArray=this.dateArray.map((t=>{const a=e.filter((e=>e.job_date===t.date));return{date:t.date,day:t.day,data:a}}))}},mounted(){this.$store.commit({type:"updateUrl",rootUrl:this.rootUrl,staticUrl:this.staticUrl});const e=p.c9.now();for(let t=0;t<7;t++){const a=e.plus({days:t}),s=this.objectData.filter((e=>e.job_date===a.toFormat("yyyy-LL-dd")));this.dateArray.push({date:a.toFormat("yyyy-LL-dd"),day:a.toFormat("cccc"),data:s})}}},ae=(0,_.A)(te,[["render",function(e,t,a,h,y,p){const m=(0,s.g2)("carbon-trash-can"),k=(0,s.g2)("draggable"),g=(0,s.g2)("confirm-user-job-delete"),j=(0,s.g2)("new-planner-object-wizard"),L=(0,s.g2)("n-config-provider");return(0,s.uX)(),(0,s.Wv)(L,{theme:p.useNBTheme(a.theme)},{default:(0,s.k6)((()=>[t[5]||(t[5]=(0,s.Lk)("h1",{class:"planner-header"},"My Planner",-1)),(0,s.Lk)("button",{class:"btn btn-primary planner-button",onClick:t[0]||(t[0]=(...e)=>p.showModal&&p.showModal(...e))},"Add Object"),(0,s.Lk)("div",l,[(0,s.Q3)(" HEADER "),(0,s.Lk)("div",r,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(y.dateArray,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.date,class:"my-planner--header-single-day"},[(0,s.Lk)("p",null,[(0,s.eW)((0,o.toDisplayString)(e.day),1),t[3]||(t[3]=(0,s.Lk)("br",null,null,-1)),(0,s.Lk)("span",n,(0,o.toDisplayString)(e.date),1)])])))),128))]),(0,s.Q3)(" BODY "),(0,s.Lk)("div",d,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(y.dateArray,((e,a)=>((0,s.uX)(),(0,s.Wv)(k,{class:"my-planner--single-day list-group",group:"objects","ghost-class":"ghost",itemKey:"user_job_id","data-job-date":e.date,"data-index":a,move:p.move,key:e.date,list:e.data,onEnd:t[1]||(t[1]=e=>p.onEnd(e))},{item:(0,s.k6)((({element:e})=>[(0,s.Lk)("div",{class:"list-group-item","data-user-job-id":e.user_job_id,"data-object-type":e.object_type,"data-location-id":e.location_id},["Closed"!==e.higher_order_status?((0,s.uX)(),(0,s.CE)("div",c)):(0,s.Q3)("v-if",!0),(0,s.Lk)("div",u,(0,o.toDisplayString)(p.formatObjectId(e)),1),(0,s.Lk)("div",null,[(0,s.Lk)("strong",{class:(0,o.normalizeClass)(p.getClass(e.higher_order_status))},(0,o.toDisplayString)(e.title),3)]),(0,s.Lk)("div",null,[t[4]||(t[4]=(0,s.eW)("Status: ")),(0,s.Lk)("span",b,(0,o.toDisplayString)(e.status),1)]),(0,s.bF)(m,{class:"kanban-card-info-icon",style:{color:"red"},onClick:t=>p.confirmCardDelete(e.user_job_id,a),onDblclick:t=>p.confirmCardDelete(e.user_job_id,a)},null,8,["onClick","onDblclick"])],8,i)])),_:2},1032,["data-job-date","data-index","move","list"])))),128))])]),(0,s.bF)(g,{"user-job-id":y.confirmIdToDelete,onRemove_user_job:p.removeUserJob},null,8,["user-job-id","onRemove_user_job"]),(0,s.bF)(j,{"date-array":y.dateArray,onUpdate_date_array:t[2]||(t[2]=e=>p.updateDateArray(e))},null,8,["date-array"])])),_:1},8,["theme"])}]])},246:(e,t,a)=>{a.d(t,{y:()=>l});var s=a(6285),o=a(953);function l(e){const t=(0,o.BA)(e);return""===t||null==t?"":s.c9.fromISO(t).toLocaleString(s.c9.DATETIME_MED)}},9581:(e,t,a)=>{a.d(t,{p:()=>l});var s=a(953),o=a(166);function l(e){return"dark"===(0,s.BA)(e)?o.a:null}}}]);