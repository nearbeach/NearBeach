"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[5253],{3241:(e,t,a)=>{a.d(t,{A:()=>G});var o=a(641),s=a(33),r=a(3751);const l={key:0,class:"error"},i=["id","data-property","data-id","data-title"],d=["id","data-id","data-property","data-title"],n=["onClick"],p=["id"],m={class:"modal-dialog"},y={class:"modal-content"},c={class:"modal-header"},h={class:"modal-title",id:"exampleModalLabel"},u=["id"],b={class:"modal-body"},I={class:"form-group"},g={key:0,class:"form-group"},L={class:"modal-footer"},k=["id"],v={class:"modal-dialog"},w={class:"modal-content"},C={class:"modal-header"},N={class:"modal-title"},P=["id"],f={class:"modal-body pb-4"},D={class:"alert alert-warning"},M={class:"row"},A={key:0,class:"row"},$={class:"modal-footer"},_=["disabled"];var E=a(9336),S=a(1581),x=a(8808),B=a(1080),O=a(1423),R=a(432),F=a.n(R),U=a(2124),T=a(9639),Q=a(3855);const X={name:"KanbanPropertyOrder",setup:()=>({v$:(0,T.Ay)()}),emits:["update_property_list"],components:{CarbonCloseOutline:a(3980).wo,draggable:F(),NRadio:S.A,NRadioGroup:x.A,NSelect:B.A,NSpace:O.A},props:{isDirty:{type:Boolean,default:!0},isNewMode:{type:Boolean,default:!0},isReadOnly:{type:Boolean,default:!1},kanbanBoardId:{type:Number,default:0},propertyList:{type:Array,default:()=>[]},propertyName:{type:String,default:""},source:{type:String,default:""}},data(){return{columnPropertyModel:"Normal",columnPropertyOptions:[{label:"Backlog",value:"Backlog"},{label:"Normal",value:"Normal"},{label:"Blocked",value:"Blocked"},{label:"Closed",value:"Closed"}],deleteItemId:"",destinationItemId:"",localPropertyList:this.propertyList,newCardDestinationList:[],newPropertyItem:"",removeCardsModel:!1,singleItemId:""}},validations:{localPropertyList:{required:Q.mw}},watch:{propertyList(){this.localPropertyList=this.propertyList}},computed:{...(0,U.L8)({canDragCards:"getCanDragCards",rootUrl:"getRootUrl"})},methods:{addItem(){""!==this.newPropertyItem&&(this.isNewMode?this.newModeAddItem():this.editModeAddItem(),this.sendPropertyListUp(),document.getElementById(`addItemClose${this.propertyName}`).click())},deleteItem(){const e=new FormData;e.set("delete_item_id",this.deleteItemId),this.removeCardsModel||e.set("destination_item_id",this.destinationItemId);const t=`${this.rootUrl}kanban_${this.propertyName.toLowerCase()}/${this.kanbanBoardId}/delete/`;this.axios.post(t,e).then((()=>{this.localPropertyList=this.localPropertyList.filter((e=>e.id!==this.deleteItemId)),this.$emit("update_property_list",{source:this.source,data:this.localPropertyList}),document.getElementById(`deleteItemClose${this.propertyName}`).click()})).catch((e=>{this.$store.dispatch("newToast",{header:"Can not delete item",message:`Sorry, but we are having issues deleting item - Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))},editItem(e){this.isReadOnly||(this.newPropertyItem=e.target.dataset.title,this.singleItemId=e.target.dataset.id,this.columnPropertyModel=e.target.dataset.property,this.openModal())},async editModeAddItem(){const e=`kanban_${this.propertyName.toLowerCase()}_name`,t=`kanban_${this.propertyName.toLowerCase()}_sort_number`,a=this.singleItemId,o=new FormData;o.set(e,this.newPropertyItem),o.set(t,this.getMaxId()+1),"Column"===this.propertyName&&o.set("kanban_column_property",this.columnPropertyModel);let s="";s=""===a?`/kanban_${this.propertyName.toLowerCase()}/${this.kanbanBoardId}/new/`:`/kanban_${this.propertyName.toLowerCase()}/${this.singleItemId}/edit/`,await this.axios.post(s,o).then((t=>{const o=t.data[0];""===a?this.localPropertyList.push({id:o.pk,property:o.fields.kanban_column_property,title:o.fields[e]}):this.localPropertyList.forEach((e=>{parseInt(e.id)===parseInt(this.singleItemId)&&(e.title=this.newPropertyItem,e.property=this.columnPropertyModel)})),this.singleItemId="",this.newPropertyItem=""})).catch((e=>{this.$store.dispatch("newToast",{header:"Can not add/edit",message:`Sorry, but we are having issues editing or adding - Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))},getMaxId(){const e=this.localPropertyList.map((e=>e.id));return e.sort(((e,t)=>e-t))[e.length-1]},newModeAddItem(){""===this.singleItemId?this.localPropertyList.push({id:this.getMaxId()+1,property:this.columnPropertyModel,title:this.newPropertyItem}):this.localPropertyList.forEach((e=>{parseInt(e.id)===parseInt(this.singleItemId)&&(e.title=this.newPropertyItem,e.property=this.columnPropertyModel)})),this.singleItemId="",this.newPropertyItem=""},openModal(){new E.aF(document.getElementById(`addItem${this.propertyName}`)).show()},removeItem(e){this.isNewMode?(this.localPropertyList=this.localPropertyList.filter((t=>t.id!==e)),this.sendPropertyListUp()):(this.deleteItemId=e,this.newCardDestinationList=this.localPropertyList.filter((e=>e.id!==this.deleteItemId)).map((e=>({value:e.id,label:e.title}))),this.destinationItemId=this.newCardDestinationList[0].value,new E.aF(document.getElementById(`deleteItem${this.propertyName}`)).show())},sendPropertyListUp(){if(this.$emit("update_property_list",{source:this.source,data:this.localPropertyList}),!this.isNewMode){const e=`/kanban_${this.propertyName.toLowerCase()}/${this.kanbanBoardId}/resort/`,t=new FormData;this.localPropertyList.forEach((e=>{t.append("item",e.id)})),this.axios.post(e,t).catch((e=>{this.$store.dispatch("newToast",{header:"Can not apply resort",message:`Sorry, we've had an issue resorting. Please refresh the page. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))}}}},G=(0,a(6262).A)(X,[["render",function(e,t,a,E,S,x){const B=(0,o.g2)("carbon-close-outline"),O=(0,o.g2)("draggable"),R=(0,o.g2)("n-select"),F=(0,o.g2)("n-radio"),U=(0,o.g2)("n-space"),T=(0,o.g2)("n-radio-group");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("strong",null,(0,s.toDisplayString)(a.propertyName),1),!E.v$.localPropertyList.required&&a.isDirty?((0,o.uX)(),(0,o.CE)("span",l," Please create at least one "+(0,s.toDisplayString)(a.propertyName)+".",1)):(0,o.Q3)("v-if",!0),(0,o.Q3)(" The column of data where you can sort the properties "),(0,o.bF)(O,{modelValue:S.localPropertyList,"onUpdate:modelValue":t[1]||(t[1]=e=>S.localPropertyList=e),disabled:!e.canDragCards||a.isReadOnly,"item-key":"pk","ghost-class":"ghost",onChange:x.sendPropertyListUp,class:"mt-4"},{item:(0,o.k6)((({element:e})=>[((0,o.uX)(),(0,o.CE)("div",{class:"sortable",key:e.id,id:e.id,"data-property":e.property,"data-id":e.id,"data-title":e.title,onDblclick:t[0]||(t[0]=e=>x.editItem(e))},[((0,o.uX)(),(0,o.CE)("strong",{key:e.id,id:e.id,"data-id":e.id,"data-property":e.property,"data-title":e.title},(0,s.toDisplayString)(e.title),9,d)),S.localPropertyList.length>1?((0,o.uX)(),(0,o.CE)("span",{key:0,onClick:t=>x.removeItem(e.id)},[(0,o.bF)(B)],8,n)):(0,o.Q3)("v-if",!0)],40,i))])),_:1},8,["modelValue","disabled","onChange"]),(0,o.Q3)(" ADD BUTTON "),t[16]||(t[16]=(0,o.Lk)("hr",null,null,-1)),!1===a.isReadOnly?((0,o.uX)(),(0,o.CE)("button",{key:1,class:"btn btn-primary",onClick:t[2]||(t[2]=(...e)=>x.openModal&&x.openModal(...e))}," Add "+(0,s.toDisplayString)(a.propertyName)+" Item ",1)):(0,o.Q3)("v-if",!0),(0,o.Q3)(" MODAL FOR ADDING AN EXTRA ROW "),(0,o.Lk)("div",{class:"modal fade",id:`addItem${a.propertyName}`,tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[(0,o.Lk)("div",m,[(0,o.Lk)("div",y,[(0,o.Lk)("div",c,[(0,o.Lk)("h5",h," Add/Edit "+(0,s.toDisplayString)(a.propertyName),1),(0,o.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",id:`addItemClose${a.propertyName}`},null,8,u)]),(0,o.Lk)("div",b,[(0,o.Lk)("div",I,[(0,o.Lk)("label",null,(0,s.toDisplayString)(a.propertyName)+" Item Description",1),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>S.newPropertyItem=e),type:"text",class:"form-control"},null,512),[[r.vModelText,S.newPropertyItem]])]),"column"===a.propertyName.toLowerCase()?((0,o.uX)(),(0,o.CE)("div",g,[(0,o.Lk)("label",null,(0,s.toDisplayString)(a.propertyName)+" Property",1),(0,o.bF)(R,{value:S.columnPropertyModel,"onUpdate:value":t[4]||(t[4]=e=>S.columnPropertyModel=e),options:S.columnPropertyOptions},null,8,["value","options"])])):(0,o.Q3)("v-if",!0)]),(0,o.Lk)("div",L,[t[9]||(t[9]=(0,o.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1)),(0,o.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=(...e)=>x.addItem&&x.addItem(...e))}," Save changes ")])])])],8,p),(0,o.Q3)(" MODAL FOR DELETING ITEM "),(0,o.Lk)("div",{class:"modal fade",id:`deleteItem${a.propertyName}`,tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[(0,o.Lk)("div",v,[(0,o.Lk)("div",w,[(0,o.Lk)("div",C,[(0,o.Lk)("h5",N,"Delete "+(0,s.toDisplayString)(a.propertyName),1),(0,o.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",id:`deleteItemClose${a.propertyName}`},null,8,P)]),(0,o.Lk)("div",f,[(0,o.Q3)(" WARNING "),(0,o.Lk)("div",D,[t[10]||(t[10]=(0,o.Lk)("h4",null,"WARNING",-1)),(0,o.Lk)("p",null," This process can not be reversed. Deleting a "+(0,s.toDisplayString)(a.propertyName)+" will remove it. ",1),t[11]||(t[11]=(0,o.Lk)("p",null," All existing cards will be moved to the stated location you have provided. Any cards that have been archived or deleted, will still be associated with the removed card. ",-1))]),(0,o.Q3)(" ASK USER ABOUT CARDS "),(0,o.Lk)("div",M,[(0,o.Lk)("p",null,"Would you like to remove the cards within the "+(0,s.toDisplayString)(a.propertyName)+"?",1),(0,o.bF)(T,{value:S.removeCardsModel,"onUpdate:value":t[6]||(t[6]=e=>S.removeCardsModel=e),name:"radiogroup"},{default:(0,o.k6)((()=>[(0,o.bF)(U,null,{default:(0,o.k6)((()=>[(0,o.bF)(F,{value:!0,label:"Yes - please remove cards"}),(0,o.bF)(F,{value:!1,label:"No - please MOVE cards"})])),_:1})])),_:1},8,["value"])]),(0,o.Q3)(" CARD DESTINATIONS "),t[14]||(t[14]=(0,o.Lk)("div",{class:"spacer"},null,-1)),S.removeCardsModel?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.CE)("div",A,[t[12]||(t[12]=(0,o.Lk)("p",null,"Please select an appropriate destination for the current cards.",-1)),t[13]||(t[13]=(0,o.Lk)("label",null,[(0,o.Lk)("strong",null,"Destination for Cards")],-1)),(0,o.bF)(R,{options:S.newCardDestinationList,value:S.destinationItemId,"onUpdate:value":t[7]||(t[7]=e=>S.destinationItemId=e),style:{"z-index":"9999"},class:"new-card-destination"},null,8,["options","value"])]))]),(0,o.Lk)("div",$,[t[15]||(t[15]=(0,o.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1)),!1===a.isReadOnly?((0,o.uX)(),(0,o.CE)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=(...e)=>x.deleteItem&&x.deleteItem(...e)),disabled:null==this.destinationItemId}," Delete "+(0,s.toDisplayString)(a.propertyName),9,_)):(0,o.Q3)("v-if",!0)])])])],8,k)])}]])},9581:(e,t,a)=>{a.d(t,{p:()=>r});var o=a(953),s=a(7413);function r(e){return"dark"===(0,o.BA)(e)?s.a:null}}}]);